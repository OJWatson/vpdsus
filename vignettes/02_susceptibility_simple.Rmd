---
title: "Susceptibility estimates and WHO-style ranking plots"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Susceptibility estimates and WHO-style ranking plots}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
```

This vignette shows how to:

- estimate susceptibility from a panel (methods A and B), and
- produce WHO-style ranking plots with [risk_rank()], [plot_coverage_rank()], and
  [plot_susceptible_rank()].

Key columns in the example panel:

- `coverage`: vaccination coverage as a proportion in [0, 1]
- `pop_0_4`: population aged 0â€“4 (used as a simple denominator in the static method)
- `births`: births (used by the cohort reconstruction)

Key ranking parameters:

- `window_years`: the number of years used to compute a mean coverage (`coverage_mean`)
- `year_end`: the year at which susceptibility is taken for ranking

Risk categories are derived from `coverage_mean` cutpoints (see `breaks` argument
in [risk_rank()]).

```{r}
library(vpdsus)

panel <- vpdsus_example_panel()

sA <- estimate_susceptible_static(panel, coverage_col = "coverage", pop_col = "pop_0_4")
rank <- risk_rank(panel, sA, window_years = 3, year_end = 2020)

plot_coverage_rank(rank, top_n = 3)
plot_susceptible_rank(rank, top_n = 3)
```

Method B cohort reconstruction:

```{r}
sB <- estimate_susceptible_cohort(panel, coverage_col = "coverage", births_col = "births", pop_col = "pop_0_4")
risk_rank(panel, sB, window_years = 3, year_end = 2020)
```
