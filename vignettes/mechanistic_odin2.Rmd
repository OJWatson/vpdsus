---
title: "Mechanistic modelling in odin2 (scaffold)"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Mechanistic modelling in odin2 (scaffold)}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")

# This vignette is CI-safe by default. To actually *run* the code chunks, opt in:
#
#   Sys.setenv(VPDSUS_BUILD_ODIN2_VIGNETTE = "1")
#
.has_odin2 <- requireNamespace("odin2", quietly = TRUE)
.run_odin2 <- identical(Sys.getenv("VPDSUS_BUILD_ODIN2_VIGNETTE"), "1")
knitr::opts_chunk$set(eval = .has_odin2 && .run_odin2)
```

This vignette is optional.

- If `{odin2}` is not installed, chunks are shown but not executed.
- If `VPDSUS_BUILD_ODIN2_VIGNETTE != "1"` (the default), chunks are shown but not executed.

```{r}
library(vpdsus)

# Minimal discrete-time example (difference equation)
mdl <- odin2_build_model("minimal_discrete")
out <- odin2_simulate(
  mdl,
  times = 0:10,
  pars = list(inc = 1),
  initial = list(S = 0)
)

out

# Next step: a simple discrete-time susceptible balance model
mdl2 <- odin2_build_model("balance_discrete")
out2 <- odin2_simulate(
  mdl2,
  times = 0:5,
  pars = list(rho = 1, births = 0, vaccinated = 0, cases = 1),
  initial = list(S = 3)
)

out2

# Time-varying inputs (aligned to `times`)
times <- 0:4
out3 <- odin2_simulate(
  mdl2,
  times = times,
  pars = list(rho = 1),
  initial = list(S = 3),
  inputs = list(
    births = c(0, 1, 0, 0, 0),
    vaccinated = 0,
    cases = c(0, 0, 1, 0, 2)
  )
)

out3
```

In a full implementation, you would map your panel data into model inputs.
